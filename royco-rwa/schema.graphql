# === MARKETS ===

type MarketState @entity(immutable: false) {
  id: String! # <CHAIN_ID>_<MARKET_ID>
  chainId: BigInt! # Chain ID
  marketId: String! # Market ID
  ownerAddress: String! # Owner Address
  seniorVaultId: String # Senior Vault ID
  seniorVaultAddress: String! # Senior Vault Address
  juniorVaultId: String # Junior Vault ID
  juniorVaultAddress: String! # Junior Vault Address
  coverage: BigInt! # Coverage Wad
  blockNumber: BigInt! # Block Number
  blockTimestamp: BigInt! # Block Timestamp
  createdAt: BigInt! # Created At
  updatedAt: BigInt! # Updated At
}

# xxx MARKETS xxx

# === VAULTS ===

type VaultState @entity(immutable: false) {
  id: String! # <CHAIN_ID>_<VAULT_ADDRESS>
  chainId: BigInt! # Chain ID
  vaultAddress: String! # Vault Address
  marketRefId: String # Optional, Market Reference ID
  marketId: String # Optional, Market ID
  depositTokenId: String! # Deposit Token ID
  depositTokenAddress: String! # Deposit Token Address
  transfers: BigInt! # Transfers
  totalSupply: BigInt! # Total Supply
  depositors: BigInt! # Depositors
  coverage: BigInt # Optional, Coverage
  blockNumber: BigInt! # Block Number
  blockTimestamp: BigInt! # Block Timestamp
  category: String # Optional, Category ("master", "market")
  subCategory: String # Optional, Sub Category ("senior", "junior")
  createdAt: BigInt! # Created At
  updatedAt: BigInt! # Updated At
}

# xxx VAULTS xxx

# === GLOBAL ===

type GlobalTokenTransfer @entity(immutable: true) {
  id: String! # <CHAIN_ID>_<TRANSACTION_HASH>_<LOG_INDEX>
  vaultId: String! # Vault ID
  chainId: BigInt! # Chain ID
  vaultAddress: String! # Vault Address
  category: String! # Category ("shares")
  subCategory: String! # Sub Category ("mint", "burn", "transferIn", "transferOut", "deposit", "withdraw")
  tokenId: String! # Token ID
  tokenAddress: String! # Token Address
  fromAddress: String! # From Address
  toAddress: String! # To Address
  value: BigInt! # Value
  blockNumber: BigInt! # Block Number
  blockTimestamp: BigInt! # Block Timestamp
  transactionHash: String! # Transaction Hash
  logIndex: BigInt! # Log Index
  createdAt: BigInt! # Created At
}

type GlobalTokenActivity @entity(immutable: true) {
  id: String! # <CHAIN_ID>_<TRANSACTION_HASH>_<LOG_INDEX>_<VAULT_ADDRESS>_<CATEGORY>_<SUB_CATEGORY>_<TOKEN_INDEX>
  vaultId: String! # Vault ID
  chainId: BigInt! # Chain ID
  vaultAddress: String! # Vault Address
  category: String! # Category ("shares", "assets")
  subCategory: String! # Sub Category ("mint", "burn", "transferIn", "transferOut", "deposit", "withdraw")
  accountAddress: String! # Account Address
  type: String! # Type ("transfer", "request")
  tokenIndex: BigInt! # Token Index
  tokenId: String! # Token ID
  tokenAddress: String! # Token Address
  value: BigInt! # Value
  status: String! # Status ("completed", "pending", "cancelled", "approved")
  blockNumber: BigInt! # Block Number
  blockTimestamp: BigInt! # Block Timestamp
  transactionHash: String! # Transaction hash
  logIndex: BigInt! # Log Index
  createdAt: BigInt! # Created At
}

# xxx GLOBAL xxx

# === POSITIONS ===

type PositionState @entity(immutable: false) {
  id: String! # <CHAIN_ID>_<VAULT_ADDRESS>_<ACCOUNT_ADDRESS>
  vaultId: String! # Vault ID
  chainId: BigInt! # Chain ID
  vaultAddress: String! # Vault Address
  accountAddress: String! # Account Address
  shareTokenId: String! # Share Token ID
  shareTokenAddress: String! # Share Token Address
  assetTokenId: String! # Asset Token ID
  assetTokenAddress: String! # Asset Token Address
  shares: BigInt! # Shares
  assetsOwed: BigInt! # Assets Owed
  sharesOwed: BigInt! # Shares Owed
  cancelledAssetsOwed: BigInt! # Cancelled Assets Owed
  cancelledSharesOwed: BigInt! # Cancelled Shares Owed
  earningAssetsRawAmount: BigInt # Earnings (updated outside of subgraphs)
  createdAt: BigInt! # Created At
  updatedAt: BigInt! # Updated At
}

type PositionStateHistorical @entity(immutable: true) {
  id: String! # <CHAIN_ID>_<VAULT_ADDRESS>_<ACCOUNT_ADDRESS>_<BLOCK_TIMESTAMP>
  vaultId: String! # Vault ID
  chainId: BigInt! # Chain ID
  vaultAddress: String! # Vault Address
  accountAddress: String! # Account Address
  shareTokenId: String! # Share Token ID
  shareTokenAddress: String! # Share Token Address
  assetTokenId: String! # Asset Token ID
  assetTokenAddress: String! # Asset Token Address
  shares: BigInt! # Shares
  assetsOwed: BigInt! # Assets Owed
  sharesOwed: BigInt! # Shares Owed
  cancelledAssetsOwed: BigInt! # Cancelled Assets Owed
  cancelledSharesOwed: BigInt! # Cancelled Shares Owed
  earningAssetsRawAmount: BigInt # Earnings (updated outside of subgraphs)
  earningAssetsTokenAmountUsd: BigInt # Earnings (updated outside of subgraphs)
  worthUsd: BigInt # Worth in USD (updated outside of subgraphs)
  apy: BigInt # APY (updated outside of subgraphs)
  blockTimestamp: BigInt! # Block Timestamp
}

type PositionLatest @entity(immutable: false) {
  id: String! # <CHAIN_ID>_<VAULT_ADDRESS>_<ACCOUNT_ADDRESS>_<CATEGORY>
  vaultId: String! # Vault ID
  chainId: BigInt! # Chain ID
  vaultAddress: String! # Vault Address
  accountAddress: String! # Account Address
  category: String! # Category ("shares", "assets")
  tokenId: String! # Token ID
  tokenAddress: String! # Token Address
  value: BigInt! # Value of Position
  blockTimestamp: BigInt! # Block Timestamp
  createdAt: BigInt! # Created At
  updatedAt: BigInt! # Updated At
}

type PositionRequestLatest @entity(immutable: false) {
  id: String! # <CHAIN_ID>_<VAULT_ADDRESS>_<CATEGORY>_<REQUEST_ID>
  vaultId: String! # Vault ID
  chainId: BigInt! # Chain ID
  vaultAddress: String! # Vault Address
  accountAddress: String! # Account Address
  category: String! # Category ("shares", "assets")
  requestId: String! # Request ID
  requestStatus: String! # Request Status ("pending", "cancelled", "approved", "completed")
  tokenId: String! # Token ID
  tokenAddress: String! # Token Address
  value: BigInt! # Value of Position
  sharePrice: BigInt # Optional, only for async vaults that locks a share price for withdrawals
  unlockTimestamp: BigInt # Optional, only for async vaults that have an unlock timestamp for withdrawals
  blockNumber: BigInt! # Block Number
  blockTimestamp: BigInt! # Block Timestamp
  transactionHash: String! # Transaction Hash
  logIndex: BigInt! # Log Index
  createdAt: BigInt! # Created At
  updatedAt: BigInt! # Updated At
}

type PositionHistorical @entity(immutable: true) {
  id: String! # <CHAIN_ID>_<TRANSACTION_HASH>_<LOG_INDEX>_<VAULT_ADDRESS>_<ACCOUNT_ADDRESS>_<CATEGORY>
  vaultId: String! # Vault ID
  chainId: BigInt! # Chain ID
  vaultAddress: String! # Vault Address
  accountAddress: String! # Account Address
  category: String! # Category ("shares")
  tokenId: String! # Token ID
  tokenAddress: String! # Token Address
  value: BigInt! # Value of Position
  blockNumber: BigInt! # Block Number
  blockTimestamp: BigInt! # Block Timestamp
  transactionHash: String! # Transaction Hash
  logIndex: BigInt! # Log Index
  createdAt: BigInt! # Created At
}

# xxx POSITIONS xxx

# === METRICS ===

type MetricLatest @entity(immutable: false) {
  id: String! # <CHAIN_ID>_<VAULT_ADDRESS>_<CATEGORY>
  vaultId: String! # Vault ID
  chainId: BigInt! # Chain ID
  vaultAddress: String! # Vault Address
  category: String! # Category ("totalSupply", "transfers", "depositors")
  value: BigInt! # Value of Metric
  blockTimestamp: BigInt! # Block Timestamp
  createdAt: BigInt! # Created At
  updatedAt: BigInt! # Updated At
}

type MetricHistorical @entity(immutable: true) {
  id: String! # <CHAIN_ID>_<TRANSACTION_HASH>_<LOG_INDEX>_<VAULT_ADDRESS>_<CATEGORY>
  vaultId: String! # Vault ID
  chainId: BigInt! # Chain ID
  vaultAddress: String! # Vault Address
  category: String! # Category ("totalSupply", "transfers", "depositors")
  value: BigInt! # Value of Metric
  blockNumber: BigInt! # Block Number
  blockTimestamp: BigInt! # Block Timestamp
  transactionHash: String! # Transaction Hash
  logIndex: BigInt! # Log Index
}

# xxx METRICS xxx

# === CONCRETE WITHDRAWAL ===

type ConcreteEpoch @entity(immutable: false) {
  id: String! # <CHAIN_ID>_<VAULT_ADDRESS>_<EPOCH_ID>
  vaultId: String! # Vault ID
  chainId: BigInt! # Chain ID
  vaultAddress: String! # Vault Address
  epochId: BigInt! # Epoch ID
  startIndex: BigInt! # Start Index (inclusive)
  endIndex: BigInt! # End Index (exclusive)
  createdAt: BigInt! # Created At
  updatedAt: BigInt! # Updated At
}

type ConcreteWithdrawal @entity(immutable: true) {
  id: String! # <CHAIN_ID>_<VAULT_ADDRESS>_<EPOCH_ID>_<ACCOUNT_ADDRESS>
  vaultId: String! # Vault ID
  chainId: BigInt! # Chain ID
  vaultAddress: String! # Vault Address
  epochId: BigInt! # Epoch ID
  accountAddress: String! # Account Address
  index: BigInt! # Index
  createdAt: BigInt! # Created At
}

# xxx CONCRETE WITHDRAWAL xxx
