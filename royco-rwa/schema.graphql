# === MARKETS ===

type MarketState @entity(immutable: false) {
  id: String! # <CHAIN_ID>_<MARKET_ID>
  chainId: BigInt! # Chain ID
  marketId: String! # Market ID
  kernelAddress: String! # Kernel Address
  accountantAddress: String! # Accountant Address
  seniorVaultId: String! # Senior Vault ID
  seniorVaultAddress: String! # Senior Vault Address
  seniorVaultSymbol: String! # Senior Vault Symbol
  seniorVaultImplementationAddress: String! # Senior Vault Implementation Address
  seniorAssetTokenId: String! # Senior Asset Token ID
  seniorAssetTokenAddress: String! # Senior Asset Token Address
  juniorVaultId: String! # Junior Vault ID
  juniorVaultAddress: String! # Junior Vault Address
  juniorVaultSymbol: String! # Junior Vault Symbol
  juniorVaultImplementationAddress: String! # Junior Vault Implementation Address
  juniorAssetTokenId: String! # Junior Asset Token ID
  juniorAssetTokenAddress: String! # Junior Asset Token Address
  seniorVaultInitializationData: String! # Senior Vault Initialization Data
  juniorVaultInitializationData: String! # Junior Vault Initialization Data
  kernelInitializationData: String! # Kernel Initialization Data
  accountantInitializationData: String! # Accountant Initialization Data
  blockNumber: BigInt! # Block Number of when market was created
  blockTimestamp: BigInt! # Block Timestamp of when market was created
  transactionHash: String! # Transaction Hash
  logIndex: BigInt! # Log Index
  createdAt: BigInt! # Created At
  updatedAt: BigInt! # Updated At
}

type MarketVaultMap @entity(immutable: false) {
  id: String! # <CHAIN_ID>_<VAULT_ADDRESS>
  chainId: BigInt! # Chain ID
  vaultAddress: String! # Vault Address
  majorType: String! # Major Type (market)
  minorType: String! # Minor Type (senior, junior)
  partnerVaultId: String! # Partner Vault ID
  partnerVaultAddress: String! # Partner Vault Address
  marketRefId: String! # Market Reference ID
  marketId: String! # Market ID
  createdAt: BigInt! # Created At
}

# xxx MARKETS xxx

# === VAULTS ===

type VaultState @entity(immutable: false) {
  id: String! # <CHAIN_ID>_<VAULT_ADDRESS>
  chainId: BigInt! # Chain ID
  vaultAddress: String! # Vault Address
  majorType: String! # Major Type (earn, market)
  minorType: String! # Minor Type (concrete, senior, junior)
  marketRefId: String # Optional, Market Reference ID
  marketId: String # Optional, Market ID
  partnerVaultId: String # Optional, Partner Vault ID
  partnerVaultAddress: String # Optional, Partner Vault Address
  depositTokenId: String! # Deposit Token ID
  depositTokenAddress: String! # Deposit Token Address
  decimals: Int! # Decimals
  transfers: BigInt! # Transfers
  totalSupply: BigInt! # Total Supply
  depositors: BigInt! # Depositors
  blockNumber: BigInt! # Block Number of when vault was created
  blockTimestamp: BigInt! # Block Timestamp of when vault was created
  createdAt: BigInt! # Created At
  updatedAt: BigInt! # Updated At
}

# xxx VAULTS xxx

# === GLOBAL ===

type GlobalTokenTransfer @entity(immutable: true) {
  id: String! # <CHAIN_ID>_<TRANSACTION_HASH>_<LOG_INDEX>
  vaultId: String! # Vault ID
  chainId: BigInt! # Chain ID
  vaultAddress: String! # Vault Address
  category: String! # Category ("shares", "assets")
  subCategory: String! # Sub Category ("mint", "burn", "transferIn", "transferOut", "deposit", "withdraw")
  tokenId: String! # Token ID
  tokenAddress: String! # Token Address
  fromAddress: String! # From Address
  toAddress: String! # To Address
  value: BigInt! # Value
  blockNumber: BigInt! # Block Number
  blockTimestamp: BigInt! # Block Timestamp
  transactionHash: String! # Transaction Hash
  logIndex: BigInt! # Log Index
  createdAt: BigInt! # Created At
}

type GlobalTokenActivity @entity(immutable: true) {
  id: String! # <CHAIN_ID>_<TRANSACTION_HASH>_<LOG_INDEX>_<VAULT_ADDRESS>_<CATEGORY>_<SUB_CATEGORY>_<TOKEN_INDEX>
  vaultId: String! # Vault ID
  chainId: BigInt! # Chain ID
  vaultAddress: String! # Vault Address
  category: String! # Category ("shares", "assets")
  subCategory: String! # Sub Category ("mint", "burn", "transferIn", "transferOut", "deposit", "withdraw")
  accountAddress: String! # Account Address
  type: String! # Type ("transfer", "request")
  tokenIndex: BigInt! # Token Index
  tokenId: String! # Token ID
  tokenAddress: String! # Token Address
  value: BigInt! # Value
  status: String! # Status ("pending", "cancelled", "updated", "approved", "claimable", "cancelClaimed", "completed")
  blockNumber: BigInt! # Block Number
  blockTimestamp: BigInt! # Block Timestamp
  transactionHash: String! # Transaction hash
  logIndex: BigInt! # Log Index
  createdAt: BigInt! # Created At
}

# xxx GLOBAL xxx

# === POSITIONS ===

type PositionRequestLatest @entity(immutable: false) {
  id: String! # <CHAIN_ID>_<VAULT_ADDRESS>_<CATEGORY>_<REQUEST_ID>
  vaultId: String! # Vault ID
  chainId: BigInt! # Chain ID
  vaultAddress: String! # Vault Address
  accountAddress: String! # Account Address
  category: String! # Category ("shares", "assets")
  subCategory: String! # Sub Category ("withdraw", "deposit")
  requestId: String! # Request ID
  requestStatus: String! # Request Status ("pending", "cancelled", "updated", "approved", "claimable", "cancelClaimed", "completed")
  tokenId: String! # Token ID
  tokenAddress: String! # Token Address
  value: BigInt! # Value of Position
  sharePrice: BigInt # Optional, only for async vaults that locks a share price for withdrawals
  unlockTimestamp: BigInt # Optional, only for async vaults that have an unlock timestamp for withdrawals
  blockNumber: BigInt! # Block Number
  blockTimestamp: BigInt! # Block Timestamp
  transactionHash: String! # Transaction Hash
  logIndex: BigInt! # Log Index
  createdAt: BigInt! # Created At
  updatedAt: BigInt! # Updated At
}

type PositionState @entity(immutable: false) {
  id: String! # <CHAIN_ID>_<VAULT_ADDRESS>_<ACCOUNT_ADDRESS>
  vaultId: String! # Vault ID
  chainId: BigInt! # Chain ID
  vaultAddress: String! # Vault Address
  accountAddress: String! # Account Address
  shareTokenId: String! # Share Token ID
  shareTokenAddress: String! # Share Token Address
  assetTokenId: String! # Asset Token ID
  assetTokenAddress: String! # Asset Token Address
  shares: BigInt! # Shares
  assetsOwed: BigInt! # Assets Owed
  sharesOwed: BigInt! # Shares Owed
  cancelledAssetsOwed: BigInt! # Cancelled Assets Owed
  cancelledSharesOwed: BigInt! # Cancelled Shares Owed
  createdAt: BigInt! # Created At
  updatedAt: BigInt! # Updated At
}

type PositionStateHistorical @entity(immutable: true) {
  id: String! # <CHAIN_ID>_<VAULT_ADDRESS>_<ACCOUNT_ADDRESS>_<BLOCK_TIMESTAMP>
  vaultId: String! # Vault ID
  chainId: BigInt! # Chain ID
  vaultAddress: String! # Vault Address
  accountAddress: String! # Account Address
  shareTokenId: String! # Share Token ID
  shareTokenAddress: String! # Share Token Address
  assetTokenId: String! # Asset Token ID
  assetTokenAddress: String! # Asset Token Address
  shares: BigInt! # Shares
  assetsOwed: BigInt! # Assets Owed
  sharesOwed: BigInt! # Shares Owed
  cancelledAssetsOwed: BigInt! # Cancelled Assets Owed
  cancelledSharesOwed: BigInt! # Cancelled Shares Owed
  blockTimestamp: BigInt! # Block Timestamp
}

type PositionLatest @entity(immutable: false) {
  id: String! # <CHAIN_ID>_<VAULT_ADDRESS>_<ACCOUNT_ADDRESS>_<CATEGORY>
  vaultId: String! # Vault ID
  chainId: BigInt! # Chain ID
  vaultAddress: String! # Vault Address
  accountAddress: String! # Account Address
  category: String! # Category ("shares", "assets")
  tokenId: String! # Token ID
  tokenAddress: String! # Token Address
  value: BigInt! # Value of Position
  blockTimestamp: BigInt! # Block Timestamp
  createdAt: BigInt! # Created At
  updatedAt: BigInt! # Updated At
}

type PositionHistorical @entity(immutable: true) {
  id: String! # <CHAIN_ID>_<TRANSACTION_HASH>_<LOG_INDEX>_<VAULT_ADDRESS>_<ACCOUNT_ADDRESS>_<CATEGORY>
  vaultId: String! # Vault ID
  chainId: BigInt! # Chain ID
  vaultAddress: String! # Vault Address
  accountAddress: String! # Account Address
  category: String! # Category ("shares")
  tokenId: String! # Token ID
  tokenAddress: String! # Token Address
  value: BigInt! # Value of Position
  blockNumber: BigInt! # Block Number
  blockTimestamp: BigInt! # Block Timestamp
  transactionHash: String! # Transaction Hash
  logIndex: BigInt! # Log Index
  createdAt: BigInt! # Created At
}

# xxx POSITIONS xxx

# === METRICS ===

type MetricLatest @entity(immutable: false) {
  id: String! # <CHAIN_ID>_<VAULT_ADDRESS>_<CATEGORY>
  vaultId: String! # Vault ID
  chainId: BigInt! # Chain ID
  vaultAddress: String! # Vault Address
  category: String! # Category ("totalSupply", "transfers", "depositors")
  value: BigInt! # Value of Metric
  blockTimestamp: BigInt! # Block Timestamp
  createdAt: BigInt! # Created At
  updatedAt: BigInt! # Updated At
}

type MetricHistorical @entity(immutable: true) {
  id: String! # <CHAIN_ID>_<TRANSACTION_HASH>_<LOG_INDEX>_<VAULT_ADDRESS>_<CATEGORY>
  vaultId: String! # Vault ID
  chainId: BigInt! # Chain ID
  vaultAddress: String! # Vault Address
  category: String! # Category ("totalSupply", "transfers", "depositors")
  value: BigInt! # Value of Metric
  blockNumber: BigInt! # Block Number
  blockTimestamp: BigInt! # Block Timestamp
  transactionHash: String! # Transaction Hash
  logIndex: BigInt! # Log Index
  createdAt: BigInt! # Created At
}

# xxx METRICS xxx

# === FEES ===

type FeeState @entity(immutable: false) {
  id: String! # <CHAIN_ID>_<VAULT_ADDRESS>_<ACCOUNT_ADDRESS>_<MAJOR_TYPE>_<MINOR_TYPE>
  vaultId: String! # Vault ID
  chainId: BigInt! # Chain ID
  vaultAddress: String! # Vault Address
  accountAddress: String! # Account Address
  majorType: String! # Major Type ("management", "performance", "protocol")
  minorType: String! # Minor Type ("shares", "assets")
  tokenId: String! # Token ID
  tokenAddress: String! # Token Address
  value: BigInt! # Value of Fee
  rawAmount: BigInt # Raw Amount (computed off-chain)
  tokenAmount: BigInt # Token Amount (computed off-chain)
  tokenAmountUsd: BigInt # Token Amount in USD (computed off-chain)
  blockNumber: BigInt! # Block Number
  blockTimestamp: BigInt! # Block Timestamp
  transactionHash: String! # Transaction Hash
  logIndex: BigInt! # Log Index
  createdAt: BigInt! # Created At
  updatedAt: BigInt! # Updated At
}

type FeeHistorical @entity(immutable: true) {
  id: String! # <CHAIN_ID>_<TRANSACTION_HASH>_<LOG_INDEX>_<VAULT_ADDRESS>_<ACCOUNT_ADDRESS>_<MAJOR_TYPE>_<MINOR_TYPE>
  vaultId: String! # Vault ID
  chainId: BigInt! # Chain ID
  vaultAddress: String! # Vault Address
  accountAddress: String! # Account Address
  majorType: String! # Major Type ("management", "performance", "protocol")
  minorType: String! # Minor Type ("shares", "assets")
  tokenId: String! # Token ID
  tokenAddress: String! # Token Address
  value: BigInt! # Value of Fee
  rawAmount: BigInt # Raw Amount (computed off-chain)
  tokenAmount: BigInt # Token Amount (computed off-chain)
  tokenAmountUsd: BigInt # Token Amount in USD (computed off-chain)
  blockNumber: BigInt! # Block Number
  blockTimestamp: BigInt! # Block Timestamp
  transactionHash: String! # Transaction Hash
  logIndex: BigInt! # Log Index
  createdAt: BigInt! # Created At
}

# xxx FEES xxx

# === CONCRETE WITHDRAWAL ===

type ConcreteEpoch @entity(immutable: false) {
  id: String! # <CHAIN_ID>_<VAULT_ADDRESS>_<EPOCH_ID>
  vaultId: String! # Vault ID
  chainId: BigInt! # Chain ID
  vaultAddress: String! # Vault Address
  epochId: BigInt! # Epoch ID
  startIndex: BigInt! # Start Index (inclusive)
  endIndex: BigInt! # End Index (exclusive)
  createdAt: BigInt! # Created At
  updatedAt: BigInt! # Updated At
}

type ConcreteWithdrawal @entity(immutable: true) {
  id: String! # <CHAIN_ID>_<VAULT_ADDRESS>_<EPOCH_ID>_<ACCOUNT_ADDRESS>
  vaultId: String! # Vault ID
  chainId: BigInt! # Chain ID
  vaultAddress: String! # Vault Address
  epochId: BigInt! # Epoch ID
  accountAddress: String! # Account Address
  index: BigInt! # Index
  createdAt: BigInt! # Created At
}

# xxx CONCRETE WITHDRAWAL xxx
